# 3D方块搭建三视图程序

基于 JavaScript + Three.js 开发的模块化3D方块搭建程序，支持多种工作空间尺寸，实时显示四视图。

## 版本信息

**当前版本**: v0.6.0  
**发布日期**: 2024年12月  
**更新内容**: 键盘相机控制、动态视觉中心、边界限制

## 核心功能

### 🎯 工作区域
- **多种尺寸**: 支持3×3×3、5×5×5、7×7×7、9×9×9四种工作空间
- **3D网格系统**: 底面、左面、后面网格线提示
- **动态适配**: 网格线和坐标轴根据尺寸自动调整

### 🖱️ 交互操作
- **左键点击**: 添加方块（点击现有方块在其上方添加，点击底部创建第一层）
- **右键点击**: 删除最顶层方块（符合重力逻辑）
- **撤回/重做**: Ctrl+Z撤回，Ctrl+Shift+Z/Ctrl+Y重做（支持50步历史）
- **拖拽旋转**: 鼠标拖拽360度旋转视角
- **滚轮缩放**: 3-20倍距离范围缩放
- **键盘控制**: WASD前后左右移动，↑↓上下移动，←→绕中心旋转
- **14视图切换**: 6个标准视图+8个角视图，平滑四元数动画

### 📐 四视图显示
- **透视图**: 主视图，支持交互操作
- **正视图**: X-Y平面投影
- **侧视图**: Y-Z平面投影  
- **俯视图**: X-Z平面投影
- **实时同步**: 四个视图同步更新

## 操作指南

### 基本操作
1. **添加方块**: 左键点击底部平面创建第一层，或点击现有方块在其上方添加
2. **删除方块**: 右键点击方块删除该位置最顶层方块（符合重力）
3. **撤回/重做**: Ctrl+Z撤回上一步，Ctrl+Shift+Z或Ctrl+Y重做
4. **旋转视角**: 在透视图中拖拽鼠标旋转3D视角
5. **缩放视图**: 使用鼠标滚轮调整视距
6. **键盘控制**: WASD前后左右移动，↑↓上下移动，←→绕中心旋转
7. **视图切换**: 14个预设视角（6标准+8角视图），平滑四元数动画
8. **清空工作区**: 点击"清空"按钮重置所有方块

### 界面布局
- **主视图**: 透视图占据界面主要区域（左侧70%）
- **辅助视图**: 三个正交视图垂直排列（右侧30%）
- **控制面板**: 右上角操作按钮和说明

## 使用方法

1. 直接在浏览器中打开 `index.html`
2. 使用鼠标在透视图中交互
3. 观察四个视图的实时变化

## 文件结构

```
three_views/
├── index.html          # 主页面
├── js/
│   ├── main.js            # 主入口和协调器
│   ├── scene-manager.js   # 场景管理器
│   ├── camera-manager.js  # 相机管理器
│   ├── workspace-builder.js # 工作空间构建器
│   ├── block-manager.js   # 方块管理器
│   ├── interaction-handler.js # 交互处理器
│   └── history-manager.js # 历史管理器
├── README.md          # 说明文档
└── changeme.md        # 版本更新记录
```

## 技术栈

- HTML5 + CSS3
- JavaScript ES6+
- Three.js (CDN)

## 技术特性

### 模块化架构
- **依赖注入**: 各管理器通过构造函数接收app实例
- **职责分离**: 每个模块只负责特定功能
- **统一接口**: 主类提供代理方法保持兼容性
- **模块协调**: main.js作为协调器管理各模块

### 坐标系统
- **右手坐标系**: X轴向右（红色）、Y轴向上（绿色）、Z轴向外（蓝色）
- **动态适配**: 坐标轴长度和标签位置根据工作空间大小调整
- **网格对齐**: 底面、左面、后面网格线系统

### 交互技术
- **智能检测**: 双面检测平面，支持全角度射线检测
- **重力系统**: 只能删除最顶层方块，符合物理逻辑
- **堆叠系统**: 点击方块在其上方添加，点击底部创建第一层
- **容差匹配**: 0.5单位容差范围内的精确匹配
- **双键操作**: 左键添加、右键删除顶层
- **撤回系统**: 双栈技术实现，支持最多50步历史

### 视图系统
- **14视图支持**: 6个标准视图（顶/底/前/后/左/右）+ 8个角视图
- **四元数动画**: 1秒平滑过渡，避免视角瞬移
- **角视图**: 从正方体8个角观察，提供完整立体视角
- **正交对齐**: 确保切换到完全对齐的标准视图

### 渲染技术
- **WebGL渲染**: 基于Three.js的硬件加速
- **实时光照**: 环境光+方向光照明系统
- **线框显示**: 方块边缘线框增强立体感
- **场景管理**: 分组管理不同类型对象

### 性能优化
- **高效检测**: 射线投射精确点击检测
- **响应式设计**: 自适应窗口大小调整
- **内存管理**: 高效的方块创建和销毁

## 浏览器兼容性

- ✅ Chrome 80+
- ✅ Firefox 75+
- ✅ Safari 13+
- ✅ Edge 80+

## 未来规划

- 🎨 多色彩方块支持
- 💾 作品保存/加载
- 📤 导出STL/OBJ格式
- 🔧 自定义工作区大小
- 📱 移动端支持